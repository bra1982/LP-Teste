var requestAtivo;
function atualizaTotal(){valor_frete=parseFloat($("input[name=formaEnvio]:checked").attr("data-valor")||0);cupom=$("#cupom_desconto").attr("data-cupom-desconto-codigo");aplicar_no_total=$("[data-desconto-valor]").attr("data-desconto-aplicar-no-total")||"n\u00e3o";var b=parseFloat($("[data-subtotal-valor]").attr("data-subtotal-valor")||0);envio_id=$("input[name=formaEnvio]:checked").val()||null;envio_code=$("input[name=formaEnvio]:checked").data("code");requestAtivo&&(requestAtivo.abort(),requestAtivo=
null);$(".valor-total").addClass("valor-loading");requestAtivo=$.getJSON("/carrinho/valor/",{envio_id,envio_code,valor_frete,valor_subtotal:b,cupom},function(c){$(".valor-total").html("R$ "+formatar_decimal_br(c.total));$(".valor-total").attr("data-total-valor",c.total);0<$("#li-box-payment-minimum-value").length&&(c.pci_total>=c.minimum_value.value?$("#li-box-payment-minimum-value").slideUp():0<c.minimum_value.value&&($(".li-box-payment-minimum-value-left").text("R$"+formatar_decimal_br(c.minimum_value.value-
c.pci_total)),$("#li-box-payment-minimum-value").slideDown()));$(".valores-descontos").length?$(".valores-descontos").load("/carrinho/valor-descontos",function(){$(".valor-total").removeClass("valor-loading")}):$(".valor-total").removeClass("valor-loading")}).fail(function(){$(".valor-total").removeClass("valor-loading")})}var frete_gratis=!1;
function carregarFormasEnvio(b,c){var g=URL_CALCULO_FRETE;$(".formas-envio").addClass("valor-loading");$.getJSON(g,b,function(e){if(e.deliveries&&0<e.deliveries.length){$(".formas-envio ul").html("");var f="";f='<li><label class="radio"><input type="radio" name="formaEnvio" value=":id:" data-valor=":valor_float:" data-code=":code:"><b class="prazo">:prazo: :prazo_dia:</b> <span class="cor-principal valor">R$ :valor:</span> <span class="nome">:nome:</span>';for(var h in e.deliveries){var d=e.deliveries[h],
a=f;d.name&&("mercadoenvios_api"==d.type&&(d.name=d.name.replace("MercadoEnvios ","")),a=a.replace(":id:",d.id),a=a.replace(":nome:",d.name),frete_gratis&&"frete_gratis"==d.service_name?(a=a.replace(":valor:","0,00"),a=a.replace(":valor_float:","0")):(a=a.replace(":valor:",formatar_decimal_br(d.price)),a=a.replace(":valor_float:",d.price)),a=a.replace(":code:",d.code),a=a.replace(":prazo:",d.deliveryTime),a=a.replace(":prazo_dia:",1==d.deliveryTime?"dia \u00fatil":"dias \u00fateis"),d.msgErro&&(a+=
'<span class="aviso" style="display: none;">'+d.msgErro+"</span>"),a+="</li>",$(".formas-envio ul").append(a))}$.cookie("forma_envio")&&($(".formas-envio input[value="+$.cookie("forma_envio")+"]").prop("checked",!0),$.cookie("forma_envio_code")&&$(".formas-envio input[value="+$.cookie("forma_envio")+"][data-code="+$.cookie("forma_envio_code")+"]").prop("checked",!0));atualizaTotal()}else $(".formas-envio ul").html(""),c?$(".formas-envio ul").append("<li>Nenhuma forma de envio encontrada.</li>"):setTimeout(function(){carregarFormasEnvio(b,
!0)},500)}).fail(function(){$(".formas-envio ul").html("");c?$(".formas-envio ul").append("<li>N\u00e3o foi poss\u00edvel carregar as formas de envio. Tente novamente.</li>"):setTimeout(function(){carregarFormasEnvio(b,!0)},500)}).always(function(){$(".formas-envio").removeClass("valor-loading")})}
$(function(){$("[rel=tooltip]").tooltip();"frete-gratis"==$("[data-desconto-tipo]").attr("data-desconto-tipo")&&(frete_gratis=!0);$.cookie("cep")&&$.cookie("cep")!==$("#formCalcularFrete .input-cep").val()&&$("#formCalcularFrete .input-cep").val($.cookie("cep"));$("#formCalcularFrete").submit(function(){var b=$(this).find(".input-cep").val();if(!b)return!1;var c={cep:b};$.cookie("cep",b,{expires:7,path:"/"});carregarFormasEnvio(c,!1);return!1}).submit();$("#formCalcularFrete .input-cep").bind("change keyup input",
function(){var b=$(this).data("cep_old"),c=$(this).val();b!=c&&9==$(this).val().length&&0>$(this).val().indexOf("_")&&($(this).data("cep_old",c),$("#formCalcularFrete").submit())});$(".formas-envio ul").click(function(){var b=$('input[name="formaEnvio"]:checked').val();$.cookie("forma_envio",b,{expires:7,path:"/"});b=$('input[name="formaEnvio"]:checked').attr("data-code");$.cookie("forma_envio_code",b,{expires:7,path:"/"});atualizaTotal()});$(".formas-envio").on("change",'input[name="formaEnvio"]',
function(){$("#formCalcularFrete .controls .envio-aviso").length&&$("#formCalcularFrete .controls .envio-aviso").remove();$(this).parent().find(".aviso").length&&$("#formCalcularFrete .controls").append('<p class="envio-aviso">'+$(this).parent().find(".aviso").text()+"</p>")});$(".tabela-carrinho").length&&atualizaTotal();$("#modalSolicitarOrcamento").on("hidden",function(b){$(this).removeData()});$("[name=quantidade]").keyup(function(b){$(this).parent().find(".atualizar-quantidade").fadeIn()});$("[name=quantidade]").focusout(function(b){$(this).parent().find(".atualizar-quantidade").fadeOut()})});
